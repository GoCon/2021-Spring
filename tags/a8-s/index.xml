<?xml version="1.0" encoding="utf-8" standalone="yes"?>
<rss version="2.0" xmlns:atom="http://www.w3.org/2005/Atom">
  <channel>
    <title>A8-S on Go Conference 2021 Spring</title>
    <link>https://gocon.jp/2021spring/tags/a8-s/</link>
    <description>Recent content in A8-S on Go Conference 2021 Spring</description>
    <generator>Hugo -- gohugo.io</generator>
    <language>ja</language><atom:link href="https://gocon.jp/2021spring/tags/a8-s/index.xml" rel="self" type="application/rss+xml" />
    <item>
      <title>GraphQLライブラリ gqlgencを作成した</title>
      <link>https://gocon.jp/2021spring/sessions/session-a8-s/</link>
      <pubDate>Mon, 01 Jan 0001 00:00:00 +0000</pubDate>
      
      <guid>https://gocon.jp/2021spring/sessions/session-a8-s/</guid>
      <description>GraphQLのQueryからクライアントを自動生成するgqlgencを作成しました。本発表では、GraphQLクライアントに必要な構成要素、実装方法、ライブラリを解説します。これらを知ることでGraphQLのクライアントツールをGoで実装可能になります。既存のライブラリはJSONを取得する機能だけを持ち、開発者が構造体へのMarshalingやQueryに対応する型を定義する必要があります。この手法ではQueryの数に応じて実装コストが増加するため開発者へ負担が大きいです。この問題を解決するためにGraphQL Queryから構造体とクライアントを自動生成生成するライブラリを作成しました。
 概要 GraphQLのQueryからクライアントを生成するライブラリgqlgencを作成しました。既存にもいくつかGraphQLのライブラリは存在していますが、開発者が構造体へのMarshalingや、Queryごとに対応する型を定義する必要があります。GraphQLは独自のQuery文法によって表現力が高いので、それでは開発者への負担が大きくなります。それを解決するためにQueryからレスポンスの構造体とクライアントを生成するライブラリを作成しました
問題提起 現在GraphQLのAPIクライアントで必要となる要素は以下のものが最低限あります
 GraphQL Schema Parser : GraphQLスキーマを静的解析してASTツリーを作る Introspection to Client Schema：サーバーからSchema情報を取得してASTツリーを作る GraphQL Query Parser：GraphQLクエリーを静的解析してASTツリーを作る GraphQL Query Response Model Generator：スキーマとクエリーのASTからGraphQLの型を生成する GraphQL Client Generator：生成された型を利用してGraphQLのリクエストとレスポンスを受けるコードを生成する GraphQL JSON Parser：GraphQL特有のJSONをパースして、生成された型にマッピングする  GoにもGraphQLのクライアントはいくつか存在しています。
 github.com/shurcooL/graphql github.com/machinebox/graphql  しかし、これらはシンプルなクライアントとなっており、上記の条件を満たしているものではありません。そうなると、開発者への負担が大きくなってしまいます。実際クライアントを使ってみて、Queryを変更する度に構造体を手動で直さないといけなくなってしまい、二重管理が大変でしたし、Queryの数が多くなると、ミスやバグが目立つようになりました。
考察 そこで上記のリストに当てはまるものがGoで存在しないかをまず探しました。
 GraphQL Schema Parser : https://github.com/vektah/gqlparser Introspection to Client Schema：見つかりませんでした GraphQL Query Parser： https://github.com/vektah/gqlparser GraphQL Query Response Model Generator： https://github.com/99designs/gqlgenがModelのみ生成 GraphQL Client Generator：見つかりませんでした GraphQL JSON Parser：github.com/shurcooL/graphql  gqlgenというGoのGraphQLサーバーを作成するライブラリ周りで、SchemaやModel周りはサーバーと共通なので、同じように扱うことができそうでしたし、gqlgenのプラグイン機構を利用すれば、SchemaとQueryのASTのツリーを取得することが可能であることがわかりました。しかし、クライアント向けに特に必要な機能がいくつか見当たりませんでしたので、これらは自前で用意する必要がありそうだと考えました。よって以下を実装する必要があります
  Introspection to Client Schema</description>
    </item>
    
  </channel>
</rss>
